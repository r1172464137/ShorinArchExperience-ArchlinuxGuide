#!/bin/bash

# 啟動時先同步一次（防止遺漏）
X_INIT=$(xclip -o -selection clipboard 2>/dev/null)
W_INIT=$(wl-paste 2>/dev/null)
if [ -n "$X_INIT" ] && [ "$X_INIT" != "$W_INIT" ]; then
    echo -n "$X_INIT" | wl-copy
fi

# 開始監聽循環
while clipnotify; do
    # 1. 讀取 X11 剪貼簿 (Typora 裡的內容)
    X_CONTENT=$(xclip -o -selection clipboard 2>/dev/null)

    # 2. 讀取 Wayland 剪貼簿 (為了比對)
    W_CONTENT=$(wl-paste 2>/dev/null)

    # 3. 【關鍵】只有當兩邊內容不一致時，才執行寫入！
    # 這行判斷就是防止死循環的煞車
    if [ -n "$X_CONTENT" ] && [ "$X_CONTENT" != "$W_CONTENT" ]; then
        echo -n "$X_CONTENT" | wl-copy
    fi
done
